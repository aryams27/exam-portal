<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Simple Online Exam</title>
  <style>
    :root{--bg:#f5f7fb;--card:#fff;--accent:#1f6feb;--muted:#6b7280}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);margin:0;padding:24px;display:flex;align-items:flex-start;justify-content:center;min-height:100vh}
    .container{width:900px;max-width:96%;background:var(--card);border-radius:12px;box-shadow:0 8px 30px rgba(15,23,42,0.08);padding:24px}
    h1{margin:6px 0 12px;font-size:20px}
    .row{display:flex;gap:16px;align-items:center}
    .col{flex:1}
    label{display:block;margin-bottom:6px;color:var(--muted);font-size:13px}
    input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:15px}
    button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer}
    .muted{color:var(--muted);font-size:14px}
    .center{text-align:center}
    .exam-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .timer{font-weight:700;color:#b91c1c}
    .question-box{background:#fcfcff;border:1px solid #eceffc;padding:16px;border-radius:10px;min-height:180px}
    textarea{width:100%;min-height:100px;padding:12px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px;resize:vertical}
    .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
    .small{font-size:13px;color:var(--muted)}
    .results{background:#fff7ed;border:1px solid #ffe5c4;padding:14px;border-radius:10px}
    .hide{display:none}
    .step{font-size:13px;color:var(--muted)}
    .download{background:transparent;color:var(--accent);border:1px dashed var(--accent);padding:8px 12px;border-radius:8px}
  </style>
</head>
<body>
  <div class="container" id="app">
    <!-- 1. Landing / name -->
    <div id="landing">
      <h1>Start Exam</h1>
      <p class="muted">Enter the student's name and click <strong>Start Exam</strong>.</p>
      <label for="studentName">Enter name</label>
      <input id="studentName" type="text" placeholder="Type name here..." />
      <div style="height:12px"></div>
      <label class="small">Total exam time (minutes)</label>
      <input id="examMinutes" type="text" value="60" style="width:120px" />
      <div style="height:12px"></div>
      <div class="row" style="margin-top:8px">
        <button id="startBtn">Start Exam</button>
        <div class="small" style="margin-left:10px">This opens the exam screen.</div>
      </div>
    </div>

    <!-- 2. Exam screen -->
    <div id="examScreen" class="hide">
      <div class="exam-head">
        <div>
          <div class="step">Welcome, <strong id="displayName"></strong></div>
          <div class="small">Question <span id="qIndex">1</span> / <span id="qTotal">1</span></div>
        </div>
        <div class="row" style="align-items:center">
          <div class="small" style="margin-right:12px">Time left</div>
          <div class="timer" id="timerDisplay">00:00</div>
        </div>
      </div>

      <div id="questionArea" class="question-box">
        <div id="questionText" style="font-weight:600;margin-bottom:10px">Question will appear here</div>
        <textarea id="answerBox" placeholder="Type your answer here..."></textarea>
        <div class="actions">
          <button id="prevBtn" style="background:#e6e9ef;color:#111">Previous</button>
          <button id="submitAnswer">Submit Answer & Next</button>
        </div>
      </div>

      <div style="margin-top:12px" class="small muted">You can submit answer for each question. When time's up the exam ends automatically.</div>
    </div>

    <!-- 3. Results screen -->
    <div id="resultsScreen" class="hide">
      <h1>Exam Finished</h1>
      <div class="results">
        <div class="small">Student: <strong id="resName"></strong></div>
        <div class="small">Time taken: <strong id="timeTaken"></strong></div>
        <div class="small">Score: <strong id="finalScore"></strong></div>
        <div class="small">Grade: <strong id="finalGrade"></strong></div>
        <div style="height:8px"></div>
        <div id="answersList"></div>
        <div style="height:10px"></div>
        <button id="downloadCSV" class="download">Download answers (CSV)</button>
        <button id="restart" style="margin-left:8px">Restart</button>
      </div>
    </div>
  </div>

<script>
/* Exam Questions + Correct Answers */
const QUESTIONS = [
  {q: "Write the number name for 4,57,682?", ans: "Four lakh fifty-seven thousand six hundred eighty two"},
  {q: "Find the next number: 2, 4, 8, 16, ___?", ans: "32"},
  {q: "Write the successor of 99,999?", ans: "100000"},
  {q: "Find the predecessor of 5,00,001?", ans: "500000"},
  {q: "Compare and write greater: 3,45,678 or 34,567?", ans: "345678"},
  {q: "Write the place value of 7 in 2,73,914?", ans: "70000"},
  {q: "Write the face value of 9 in 9,48,362?", ans: "9"},
  {q: "Arrange in ascending order: 4,23,567; 3,45,678; 5,67,890?", ans: "3,45,678 , 4,23,567 , 5,67,890"},
  {q: "Form the greatest 6-digit number using digits 1,3,5,7,8,0?", ans: "875310"},
  {q: "Form the smallest 6-digit number using digits 1,3,5,7,8,0?", ans: "103578"},
  {q: "Find the sum: 2,34,567 + 3,45,678?", ans: "580245"},
  {q: "A pen costs ₹15. Cost of 325 pens?", ans: "₹4875"},
  {q: "A packet has 24 pencils. How many in 48 packets?", ans: "1152"},
  {q: "A car travels 65 km in one hour. Distance in 12 hours?", ans: "780"},
  {q: "1440 apples are packed in 24 boxes. Apples per box", ans: "60"},
  {q: "7500 kg rice packed in 25kg bags. Bags needed?", ans: "300"},
  {q: "Find the next number: 5, 10, 20, 40, ___?", ans: "80"},
  {q: "Find the next number: 100, 90, 80, ___, 60?", ans: "70"},
  {q: "What is 3456.78 / 10000 ?", ans: "0.345678"},
  {q: "What is 5.67857 x 10000?", ans: "56785.7"},
  {q: "what is 56789 x 1248?", ans: "70872672"},
  {q: "What is 79868 / 80?", ans: "998.35"},
  {q: "What is 9587264 - 5263555?", ans: "4323709"},
  {q: "What is 10000 / 500?", ans: "20"},
  {q: "What is 5785 x 100000?", ans: "578500000"},
];
const landing = document.getElementById('landing');
const examScreen = document.getElementById('examScreen');
const resultsScreen = document.getElementById('resultsScreen');
const startBtn = document.getElementById('startBtn');
const studentNameInput = document.getElementById('studentName');
const examMinutesInput = document.getElementById('examMinutes');

const displayName = document.getElementById('displayName');
const qIndexEl = document.getElementById('qIndex');
const qTotalEl = document.getElementById('qTotal');
const questionText = document.getElementById('questionText');
const answerBox = document.getElementById('answerBox');
const submitAnswerBtn = document.getElementById('submitAnswer');
const prevBtn = document.getElementById('prevBtn');
const timerDisplay = document.getElementById('timerDisplay');

const resName = document.getElementById('resName');
const timeTakenEl = document.getElementById('timeTaken');
const finalScore = document.getElementById('finalScore');
const finalGrade = document.getElementById('finalGrade');
const answersList = document.getElementById('answersList');
const downloadCSV = document.getElementById('downloadCSV');
const restartBtn = document.getElementById('restart');

let studentName = '';
let examDuration = 0; // seconds
let timerInterval = null;
let examStartTime = null;
let examEndTime = null;

let currentQ = 0;
let answers = [];

// init
qTotalEl.textContent = QUESTIONS.length;

startBtn.addEventListener('click', () => {
  const name = studentNameInput.value.trim();
  if (!name) { alert('Please enter a name'); studentNameInput.focus(); return; }
  studentName = name;
  const mins = parseFloat(examMinutesInput.value) || 60;
  examDuration = Math.max(30, Math.round(mins * 60)); // at least 30 seconds
  startExam();
});

function startExam(){
  landing.classList.add('hide');
  examScreen.classList.remove('hide');
  displayName.textContent = studentName;
  answers = Array(QUESTIONS.length).fill('');
  currentQ = 0;
  updateQuestion();
  examStartTime = new Date();
  startTimer(examDuration);
  setTimeout(()=>answerBox.focus(), 200);
}

function updateQuestion(){
  qIndexEl.textContent = currentQ+1;
  questionText.textContent = QUESTIONS[currentQ].q;
  answerBox.value = answers[currentQ] || '';
  prevBtn.disabled = currentQ === 0;
}

submitAnswerBtn.addEventListener('click', () => {
  saveAnswerAndNext();
});

prevBtn.addEventListener('click', () => {
  answers[currentQ] = answerBox.value;
  if (currentQ > 0) currentQ--;
  updateQuestion();
});

function saveAnswerAndNext(){
  answers[currentQ] = answerBox.value;
  if (currentQ < QUESTIONS.length - 1){
    currentQ++;
    updateQuestion();
    answerBox.focus();
  } else {
    finishExam();
  }
}

function startTimer(duration){
  let remaining = duration;
  updateTimerDisplay(remaining);
  timerInterval = setInterval(()=> {
    remaining--;
    if (remaining <= 0){
      updateTimerDisplay(0);
      clearInterval(timerInterval);
      alert('Time is up! Exam will be submitted.');
      finishExam();
      return;
    }
    updateTimerDisplay(remaining);
  }, 1000);
}

function updateTimerDisplay(sec){
  const m = Math.floor(sec/60).toString().padStart(2,'0');
  const s = (sec%60).toString().padStart(2,'0');
  timerDisplay.textContent = `${m}:${s}`;
}

function finishExam(){
  if (timerInterval) clearInterval(timerInterval);
  examEndTime = new Date();
  examScreen.classList.add('hide');
  resultsScreen.classList.remove('hide');
  showResults();
}

function showResults(){
  resName.textContent = studentName;
  const secs = Math.round((examEndTime - examStartTime)/1000);
  const mm = Math.floor(secs/60), ss = secs%60;
  timeTakenEl.textContent = `${mm}m ${ss}s`;

  // Calculate score
  let score = 0;
  QUESTIONS.forEach((q, i) => {
    if (answers[i].trim().toLowerCase() === q.ans.toLowerCase()) {
      score++;
    }
  });
  finalScore.textContent = `${score}/${QUESTIONS.length}`;

  // Grade
  let percent = (score / QUESTIONS.length) * 100;
  let grade = "";
  if (percent >= 80) grade = "A";
  else if (percent >= 60) grade = "B";
  else if (percent >= 40) grade = "C";
  else grade = "F";
  finalGrade.textContent = grade;

  // Show answers
  answersList.innerHTML = '';
  QUESTIONS.forEach((q, i) => {
    const d = document.createElement('div');
    d.style.marginBottom = '10px';
    d.innerHTML = `<div style="font-weight:600">Q${i+1}. ${q.q}</div>
                   <div style="white-space:pre-wrap;margin-top:6px">Answer: ${escapeHtml(answers[i]||'<no answer>')}</div>
                   <div style="color:${answers[i].trim().toLowerCase() === q.ans.toLowerCase() ? 'green':'red'}">
                     Correct: ${q.ans}
                   </div>`;
    answersList.appendChild(d);
  });
}

downloadCSV.addEventListener('click', () => {
  const rows = [["Student", studentName], ["TimeTaken", timeTakenEl.textContent], ["Score", finalScore.textContent], ["Grade", finalGrade.textContent], []];
  rows.push(["Q#", "Question", "Answer", "Correct"]);
  QUESTIONS.forEach((q, i) => rows.push([i+1, q.q, answers[i] || "", q.ans]));
  const csv = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${studentName.replace(/\s+/g,'_')}_results.csv`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

restartBtn.addEventListener('click', ()=>location.reload());

function escapeHtml(text){
  return text
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;');
}
</script>
</body>
</html>

